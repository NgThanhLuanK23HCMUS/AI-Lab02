\documentclass[12pt, a4paper]{article} 
\usepackage[utf8]{inputenc}
\usepackage[english]{babel}
\usepackage{graphicx}
\usepackage{amsmath,amssymb}
\usepackage{lmodern}
\usepackage{tikz}
\usepackage{tabularx}
\usepackage{makecell}
\usetikzlibrary{arrows.meta, positioning}
\usepackage{iftex}
\ifPDFTeX
  \usepackage[T1]{fontenc}
  \usepackage[utf8]{inputenc}
  \usepackage{textcomp} % provide euro and other symbols
\else % if luatex or xetex
  \usepackage{unicode-math}
  \defaultfontfeatures{Scale=MatchLowercase}
  \defaultfontfeatures[\rmfamily]{Ligatures=TeX,Scale=1}
\fi
\usepackage{amsmath, amssymb, amsfonts}
\usepackage[left=2.5cm, right=2.5cm, top=2.5cm, bottom=2.5cm]{geometry}
\usepackage{caption} 
\usepackage{booktabs}
\usepackage{hyperref}
\hypersetup{
    colorlinks=true,
    linkcolor=blue,
    filecolor=magenta,
    urlcolor=cyan,
}
\usepackage{fancyhdr}
\usepackage{enumitem} 
\usepackage{lipsum}
\usepackage{float}
\usetikzlibrary{positioning, arrows.meta}

\pagestyle{fancy}
\fancyhf{} 
\fancyhead[L]{\nouppercase{\rightmark}}
\fancyhead[R]{\thepage} 
\fancyfoot[C]{}
\renewcommand{\headrulewidth}{0.4pt} 
\renewcommand{\footrulewidth}{0pt} 

% Trang bia
\title{
    \textbf{Ho Chi Minh University of Science} \\
    \textbf{Department of Information Technology} \\
    \vspace{0.5cm}
    \includegraphics[width=0.5\textwidth]{img/logohcmus.png} \\
    \vspace{1cm}
    \huge \textbf{Lab02 Report: Hashiwokakero} \\
    \vspace{1cm}   
    \Large \textbf{Course: Introduction to Artificial Intelligence} \\
    \Large \textbf{Instructor: Vo Nhat Tan} \\
}
\author{
    \shortstack[l] {
        \textbf{23127296 - Nguyen Thanh Luan} \\
        \textbf{23127302 - Tran Quang Phuc} \\
        \textbf{23127539 - Nguyen Thanh Tien} \\
        \textbf{23127543 - Vu Van Vu} \\
    }
}
\date{July, 2025} 

\begin{document}

\maketitle 

% muc luc
\newpage 
\tableofcontents 

% introduction
\newpage 

\section{Introduction}
\begin{table}[htbp]
    \centering
    \caption{Contribution table}
    \label{tab:contribution}
    \begin{tabular}{@{}lc@{}} % bo khoang trong
        \toprule
        \textbf{Work} & \textbf{Member} \\
        \midrule
        Formulate CNF constraints & Nguyen Thanh Luan\\
        Automate CNF generation & Nguyen Thanh Luan \\
        Design input files & Tran Quang Phuc \\
        Implement backtracking & Nguyen Thanh Tien \\
        Implement brute-force & Vu Van Vu  \\
        Implement A* & Tran Quang Phuc \\
        Solve using PySat & Nguyen Thanh Luan \\
        \bottomrule
    \end{tabular}
\end{table}

\begin{table}[htbp]
    \centering
    \caption{Requirement completion table}
    \label{tab:contribution}
    \begin{tabular}{@{}lc@{}} % bo khoang trong
        \toprule
        \textbf{Requirements} & \textbf{Completion level} \\
        \midrule
        Design at least 10 input files & Yes\\
        Formulate CNF constraints & Yes \\
        Automate CNF generation & Yes \\
        Use PySat to solve & Yes\\
        Implement backtracking & Yes\\
        Implement brute-force & Yes\\
        Implement A* & Yes\\
        Detailed explanation of algorithms & Yes \\
        Results and evaluation & Yes \\
        Report & Yes\\
        \bottomrule
    \end{tabular}
\end{table}
\section{Problem Introduction}
Hashiwokakero (also known as Bridges) is a Japanese puzzle. It is played on a rectangular grid. There are islands on the grid. The player can draw bridges between the islands in a straight line. The goal is to make all the islands form a single connected group. The puzzle follows the following rules:
\begin{itemize}
    \item They must begin and end at distinct islands, travelling a straight line in between.
    \item They must not cross any other bridges or islands.
    \item They may only run orthogonally (i.e. they may not run diagonally).
    \item At most two bridges connect a pair of islands.
    \item The number of bridges connected to each island must match the number on that island.
    \item The bridges must connect the islands into a single connected group.
\end{itemize}
\section{Encode Hashiwokakero to CNF}
\subsection{Logical Variable Definition}
To obtain the CNF formula for the Hashiwokakero puzzle, first we introduce a logical variable \\
\[ x_{i,j,i',j',k} \]
where 
\begin{itemize}
  \item $(i,j)$ and $(i',j')$ is the location of the 2 islands.
  \item $k$ is the number of bridges between 2 islands.($k=1,2$)
\end{itemize}
\subsection{CNF constraints}
The following constraints are converted to CNF in order to solve the Hashiwokakero puzzle:
\subsubsection{Bridges must begin and end at distinct islands, travelling in a straight line}
\begin{itemize}
    \item The endpoints $(i,j)$ and $(i',j')$ must be different: $(i,j) \ne (i',j')$.
    \item The bridge must lie on the same row or the same column:
    \[
    \forall i, j, i', j', k \quad \left( x_{i,j,i',j',k} \rightarrow \left[ (i = i' \land j \ne j') \lor (j = j' \land i \ne i') \right] \right)
    \]
    
\end{itemize}
\subsubsection{Bridges must not cross any other bridges}
Two bridges $x_{i_1,j_1,i_1',j_1',k_1}$ and $x_{i_2,j_2,i_2',j_2',k_2}$ intersect if:

\begin{itemize}
  \item $i_1 = i_1'$, $j_2 = j_2'$ (one runs horizontal, one runs vertical),
  \item $i_2 < i_1 < i_2'$, and $j_1 < j_2 < j_1'$ (they cross each other),
  \item $\{i_1,j_1\}, \{i_1',j_1'\} \ne \{i_2,j_2\}, \{i_2',j_2'\}$ (they don't run from same islands).
\end{itemize}
\subsubsection{At most two bridges connect a pair of islands}
The number of bridges is equal or smaller than 2:
\[
    \forall i, j, i', j', k \quad ( x_{i,j,i',j',k} \rightarrow 0 \leq k \leq 2)
    \]
\subsubsection{The number of bridges connected to each island must match the number on that island}
Let $B_{i,j}$ be the number of bridges connecting to the island located at ($i$, $j$).

\[
\sum_{\substack{i',j',k \\ (i',j',k) \in D}} k \cdot x_{i,j,i',j',k} = B_{i,j}
\]

where 
\begin{itemize}
    \item $D$ is the set of all islands $(i',j')$ that can go directly to $(i,j)$.
\end{itemize}
\subsection{Implementation}
\subsubsection{Generating bridge variables}
Firstly, the logical variables are generated by looping through the input file. The idea is to consider 4 direction from an island ($i$, $j$). If an island ($i'$, $j'$) is met during a direction, then two variables $x_{i,j,i',j',1}$ and $x_{i,j,i',j',2}$ are added to the list of variables.
\subsubsection{Adding constraints ensuring that $x_{i,j,i',j',1}$ and $x_{i,j,i',j',2}$ cannot coexist}
For every pair $x_{i,j,i',j',1}$ and $x_{i,j,i',j',2}$, we add the following condition to ensure they cannot coexist.
\[
\lnot v_1 \lor \lnot v_2
\]
\subsubsection{Adding constraints ensuring that the number of bridges to the island must match the number on that island}
For every island, we do the following:
\begin{itemize}
    \item Get all the logical variables representing bridges connect directly to that island.
    \item Find the combinations of those logical variables that satisfy the condition.
    \item We define a new variable $c$ for every combination.
    \item For every combination {$v_1$, $v_2$, ..., $v_n$}, we add \(\lnot v_1 \lor \lnot v_2 \lor \dots \lor v_n \lor c\), and for every logical variable $v_i$ in the combination, we add \(\lnot c \lor v_i\). These steps are the equivalence of adding \(c \iff v_1 \land v_2 \land \dots \land v_n\).
    \item For every combination, we also add the negative of all the logical variables in first step that are not in the combinations.
    \item For every pair of combinations $c_1$ and $c_2$, we add \(\lnot c_1 \lor \lnot c_2\), to ensure at most one combination is valid.
    \item For all combinations {$c_1$, $c_2$, ..., $c_n$}, we add \(\ c_1 \lor \ c_2 \lor \dots \lor c_n\) to ensure at least one combination is correct.
\end{itemize}
\subsubsection{Adding constraints ensuring no bridges cross each other}
For every logical variable $x_{i_1,j_1,i_1',j_1',k_1}$ (or $v_1$), we do the following:
\begin{itemize}
    \item For every logical $x_{i_2,j_2,i_2',j_2',k_2}$ (or $v_2$), check the following condition:
    \begin{itemize}
        \item $i_1 = i_1'$, $j_2 = j_2'$ (one runs horizontal, one runs vertical),
        \item $i_2 < i_1 < i_2'$, and $j_1 < j_2 < j_1'$ (they cross each other),
        \item $\{i_1,j_1\}, \{i_1',j_1'\} \ne \{i_2,j_2\}, \{i_2',j_2'\}$ (they don't run from same islands).
    \end{itemize}
    \item If all the conditions are satisfied we add \(\lnot v_1 \lor \lnot v_2\) to ensure these bridges cannot coexist.
\end{itemize}

\section{Algorithm Explanation}

\input{report/backtracking}
\input{report/brute_force}
\input{report/A_Star}

\section{Results}
\subsection{Test cases}
\subsection{Results}
\subsection{Algorithm Comparisons}

\end{document}